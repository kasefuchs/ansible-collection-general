{{ common_managed_header | ansible.builtin.comment }}
[Unit]
Description=Tailscale daemon
Documentation=https://tailscale.com/kb/

Wants=network-online.target
After=network-online.target

[Service]
Type=notify
User=root

ExecStart={{ tailscale_install_daemon_binary }} --state=${STATE_DIRECTORY}/tailscaled.state --socket=${RUNTIME_DIRECTORY}/tailscaled.sock
ExecStopPost={{ tailscale_install_daemon_binary }} --cleanup

Environment=TS_NO_LOGS_NO_SUPPORT=true

KillMode=process
KillSignal=SIGTERM

Restart=always
RestartSec=5s

AmbientCapabilities=CAP_NET_ADMIN

RuntimeDirectory=tailscale
RuntimeDirectoryMode=0755

StateDirectory=tailscale
StateDirectoryMode=0700

CacheDirectory=tailscale
CacheDirectoryMode=0750

[Install]
WantedBy=multi-user.target
